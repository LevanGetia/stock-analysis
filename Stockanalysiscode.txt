Sub CalcYearlyData()    Dim ws As Worksheet    Dim rng As Range, cell As Range    Dim ticker As String, openingPrice As Double, closingPrice As Double, totalVolume As Double    Dim yearlyChange As Double, percentChange As Double    Dim outputRow As Long    Dim searchRange As Range, findResult As Range, ConFrmt As Range        For Each ws In ThisWorkbook.Sheets                       Set rng = ws.Range("A2:A" & ws.Cells(Rows.Count, "A").End(xlUp).Row)        Set searchRange = ws.Range("I:I")     Range("I1").Value = "Ticker"                 Range("J1").Value = "Yearly change"                 Range("K1").Value = "Percentage change"                 Range("L1").Value = "Total stock volume"                 Range("I1:L1").Font.Bold = True                 Range("I1:L1").Columns.AutoFit        ticker = ws.Cells(2, "A").Value        openingPrice = ws.Cells(2, "C").Value        totalVolume = 0        For Each cell In rng.Cells            If ws.Cells(cell.Row, "A").Value <> ticker Then                yearlyChange = closingPrice - openingPrice                If openingPrice <> 0 Then ' Checking if openingPrice is not zero to avoid error                    percentChange = (closingPrice - openingPrice) / openingPrice                Else                    percentChange = 0 ' Assigning 0 if openingPrice is zero to avoid division by zero error                End If                Set findResult = searchRange.Find(ticker)                If Not findResult Is Nothing Then                    ' Update existing row                    outputRow = findResult.Row                    ws.Cells(outputRow, "J").Value = ws.Cells(outputRow, "J").Value + yearlyChange                    ws.Cells(outputRow, "K").Value = ws.Cells(outputRow, "K").Value + percentChange                    ws.Cells(outputRow, "L").Value = ws.Cells(outputRow, "L").Value + totalVolume                Else                    ' Add new row                    outputRow = ws.Cells(Rows.Count, "I").End(xlUp).Row + 1                    ws.Cells(outputRow, "I").Value = ticker                    ws.Cells(outputRow, "J").Value = yearlyChange                    ws.Cells(outputRow, "K").Value = percentChange                    ws.Cells(outputRow, "L").Value = totalVolume                End If                ' Start tracking the new stock                ticker = ws.Cells(cell.Row, "A").Value                openingPrice = ws.Cells(cell.Row, "C").Value                totalVolume = 0            End If            closingPrice = ws.Cells(cell.Row, "F").Value            totalVolume = totalVolume + ws.Cells(cell.Row, "G").Value        Next cell        ' Output the results for the last stock        yearlyChange = closingPrice - openingPrice        If openingPrice <> 0 Then ' Checking if openingPrice is not zero            percentChange = (closingPrice - openingPrice) / openingPrice        Else            percentChange = 0 ' Assigning 0 if openingPrice is zero to avoid division by zero error        End If        Set findResult = searchRange.Find(ticker)        If Not findResult Is Nothing Then            ' existing row            outputRow = findResult.Row            ws.Cells(outputRow, "J").Value = ws.Cells(outputRow, "J").Value + yearlyChange            ws.Cells(outputRow, "K").Value = ws.Cells(outputRow, "K").Value + percentChange            ws.Cells(outputRow, "L").Value = ws.Cells(outputRow, "L").Value + totalVolume        Else            ' new row            outputRow = ws.Cells(Rows.Count, "I").End(xlUp).Row + 1            ws.Cells(outputRow, "I").Value = ticker            ws.Cells(outputRow, "J").Value = yearlyChange            ws.Cells(outputRow, "K").Value = percentChange            ws.Cells(outputRow, "L").Value = totalVolume        End If' Conditional formatting for YearlySet ConFrmt = ws.Range("J2:J" & ws.Cells(Rows.Count, "J").End(xlUp).Row)With ConFrmt    .FormatConditions.Delete    .FormatConditions.AddColorScale ColorScaleType:=3    .FormatConditions(.FormatConditions.Count).SetFirstPriority    .FormatConditions(1).ColorScaleCriteria(1).Type = xlConditionValuePercentile    .FormatConditions(1).ColorScaleCriteria(1).Value = 0    .FormatConditions(1).ColorScaleCriteria(1).FormatColor.Color = RGB(255, 0, 0) ' Red    .FormatConditions(1).ColorScaleCriteria(2).Type = xlConditionValuePercentile    .FormatConditions(1).ColorScaleCriteria(2).Value = 100    .FormatConditions(1).ColorScaleCriteria(2).FormatColor.Color = RGB(0, 255, 0) ' GreenEnd With' Conditional formattingSet ConFrmt = ws.Range("K2:K" & ws.Cells(Rows.Count, "K").End(xlUp).Row)With ConFrmt    .FormatConditions.Delete    .FormatConditions.AddColorScale ColorScaleType:=3    .FormatConditions(.FormatConditions.Count).SetFirstPriority    .FormatConditions(1).ColorScaleCriteria(1).Type = xlConditionValuePercentile    .FormatConditions(1).ColorScaleCriteria(1).Value = 0    .FormatConditions(1).ColorScaleCriteria(1).FormatColor.Color = RGB(255, 0, 0) ' Red    .FormatConditions(1).ColorScaleCriteria(2).Type = xlConditionValuePercentile    .FormatConditions(1).ColorScaleCriteria(2).Value = 100    .FormatConditions(1).ColorScaleCriteria(2).FormatColor.Color = RGB(0, 255, 0) ' GreenEnd With    Next ws    End Sub