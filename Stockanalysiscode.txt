Sub CalculateYearly()    Dim ws As Worksheet    Dim rng As Range    Dim cell As Range    Dim lastRow As Long    Dim outputRow As Long    Dim ticker As String    Dim openingPrice As Double    Dim closingPrice As Double    Dim totalVolume As Double    Dim percentChange As Double    Dim highestIncreaseTicker As String    Dim highestDecreaseTicker As String    Dim highestVolumeTicker As String    Dim highestIncrease As Double    Dim highestDecrease As Double    Dim highestVolume As Double    ' Loop through all worksheets in the workbook    For Each ws In ThisWorkbook.Worksheets        ' Get the last row number in column A        lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row        Set rng = ws.Range("A2:A" & lastRow)        ' Set initial values        outputRow = 2        ticker = ws.Cells(2, "A").Value        openingPrice = ws.Cells(2, "C").Value        totalVolume = 0        ' Add headers in row 1        ws.Cells(1, "I").Value = "Ticker"        ws.Cells(1, "J").Value = "Yearly Change"        ws.Cells(1, "K").Value = "% Change"        ws.Cells(1, "L").Value = "Total Stock Volume"        ' Loop through all the rows and calculate values        For Each cell In rng.Cells            ' Check if we've moved to a new stock            If ws.Cells(cell.Row, "A").Value <> ticker Then                ' We're at a new stock, calculate values for the old stock                closingPrice = ws.Cells(cell.Row - 1, "F").Value                ws.Cells(outputRow, "I").Value = ticker                ws.Cells(outputRow, "J").Value = closingPrice - openingPrice                If openingPrice <> 0 Then ' Avoid division by zero                    percentChange = (closingPrice - openingPrice) / openingPrice                Else                    percentChange = 0                End If                ws.Cells(outputRow, "K").Value = percentChange                ws.Cells(outputRow, "L").Value = totalVolume                ' Update the highest increase, decrease, and volume if necessary                If percentChange > highestIncrease Then                    highestIncrease = percentChange                    highestIncreaseTicker = ticker                End If                If percentChange < highestDecrease Then                    highestDecrease = percentChange                    highestDecreaseTicker = ticker                End If                If totalVolume > highestVolume Then                    highestVolume = totalVolume                    highestVolumeTicker = ticker                End If                ' Move to the next output row and reset values for the new stock                outputRow = outputRow + 1                ticker = ws.Cells(cell.Row, "A").Value                openingPrice = ws.Cells(cell.Row, "C").Value                totalVolume = 0            End If            ' Add the current row's volume to the total volume            totalVolume = totalVolume + ws.Cells(cell.Row, "G").Value        Next cell        ' Apply conditional formatting to the % change column        With ws.Range("K2:K" & outputRow)            .FormatConditions.Delete            .FormatConditions.AddColorScale ColorScaleType:=2            .FormatConditions(.FormatConditions.Count).SetFirstPriority            .FormatConditions(1).ColorScaleCriteria(1).Type = xlConditionValueLowestValue            With .FormatConditions(1).ColorScaleCriteria(1).FormatColor                .Color = 7039480                .TintAndShade = 0            End With            .FormatConditions(1).ColorScaleCriteria(2).Type = xlConditionValueHighestValue            With .FormatConditions(1).ColorScaleCriteria(2).FormatColor                .Color = 5287936                .TintAndShade = 0            End With        End With                    ' Apply conditional formatting to the % change column        With ws.Range("K2:K" & outputRow)            .FormatConditions.Delete            .FormatConditions.AddColorScale ColorScaleType:=2            .FormatConditions(1).ColorScaleCriteria(1).Type = xlConditionValueLowestValue            .FormatConditions(1).ColorScaleCriteria(1).FormatColor.Color = 7039480            .FormatConditions(1).ColorScaleCriteria(2).Type = xlConditionValueHighestValue            .FormatConditions(1).ColorScaleCriteria(2).FormatColor.Color = 5287936        End With        ' Write the descriptions and greatest values to cells O1:Q3        ws.Cells(1, "O").Value = "Greatest % Increase"        ws.Cells(2, "O").Value = highestIncreaseTicker        ws.Cells(3, "O").Value = highestIncrease        ws.Cells(1, "P").Value = "Greatest % Decrease"        ws.Cells(2, "P").Value = highestDecreaseTicker        ws.Cells(3, "P").Value = highestDecrease        ws.Cells(1, "Q").Value = "Greatest Total Volume"        ws.Cells(2, "Q").Value = highestVolumeTicker        ws.Cells(3, "Q").Value = highestVolume        ws.Columns("I:Q").EntireColumn.AutoFit    Next wsEnd Sub